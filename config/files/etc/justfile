# /etc/justfile lub ~/dotfiles/justfile

setup-dots:
    #!/bin/bash
    DOT_DIR="$HOME/dotfiles"
    BACKUP_DIR="$HOME/dotfiles_backup/$(date +%Y%m%d_%H%M%S)"
    
    mkdir -p "$BACKUP_DIR"

    cd "$DOT_DIR"
    for pkg in */; do
        pkg=${pkg%/}
        
        # Ścieżka, którą stow chce zająć (np. ~/.config/niri)
        # Uproszczone: sprawdzamy najczęstsze lokalizacje
        TARGET="$HOME/.config/$pkg"
        
        # 1. Jeśli to PRAWDZIWY folder/plik (nie link), zrób kopię
        if [ -e "$TARGET" ] && [ ! -L "$TARGET" ]; then
            echo "⚠️  Wykryto konflikt dla $pkg. Przenoszę oryginał do $BACKUP_DIR"
            mkdir -p "$(dirname "$BACKUP_DIR/${pkg}")"
            mv "$TARGET" "$BACKUP_DIR/"
        fi

        # 2. Teraz stow może bezpiecznie stworzyć link
        stow -R -v -t "$HOME" "$pkg"
    done
